<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>

    <style type="text/css">

    rect {
        fill: navy;
    }
    h1 {
        width: 1200px;
    }
    h2 {
        width: 1200 px;
    }
    p {
        width: 1200px;
    }

    </style>
</head>
<body>
    <script type="text/javascript">
        function draw_first(data) {
            //graph for average loan amount by income bracket

            "use strict";//give error if javascript could silently fail
            var margin = 75,
                width = 1100 - margin,
                height = 600 - margin;

            debugger;

            //played with resizing, feel it's better to hardcode size of window in first place.

            var svg = dimple.newSvg("#income-by-bracket")
                        .attr("width", width + margin)
                        .attr("height", height + margin)
                        .append('g')
                        .attr('class','chart');


            /* d3.js Chart construction code*/

            var myChart = new dimple.chart(svg, data);
            var x = myChart.addCategoryAxis("x", "YearlyIncomeRounded");
            var y = myChart.addMeasureAxis("y", "mean_original_loan");

            x.addOrderRule("YearlyIncomeRounded", false);
            x.tickFormat = '$,';
            x.title = "Yearly Income Rounded to Lowest $10,000";

            y.title = 'Mean Loan Amount';
            y.tickFormat = '$,.f';

            x.fontSize = 12;
            y.fontSize = 12;

            var s1 = myChart.addSeries(null, dimple.plot.bar);

            /* Draw the graph*/
            myChart.draw();
            /*window.onresize = function () {
                myChart.draw(0, true);
            };*/

            //from: http://stackoverflow.com/questions/25774821/dimple-js-axis-labels
            x.categoryFields = ['Yearly Income Bracket'];
            //y.categoryFields = ['Dollar Amount of Loan'];

            //work around to get rid of ticker issue on first chart
            svg.select("g.dimple-axis").selectAll("g.tick")[0][16].remove()

            //blocks:
            //http://blockbuilder.org/anonymous/d99ae2b5665dcd610572d1a21dbf0679

            //got the title formating from Yahn at the following:
            //https://gist.github.com/yanndupis/1aa836f735732a0b119502adaed47684
            svg.append("text")
                .attr("x", myChart._xPixels() + myChart._widthPixels() / 2)
                .attr("y", myChart._yPixels() - 25)
                .style("text-anchor", "middle")
                .style("font-family", "sans-serif")
                .style("font-weight", "bold")
                .text("Average Debt Consolidation Loan by Income Bracket Granted by Prosper Loans")

        };

        function draw_second(data){

            // The Number of Loans Graph
            var margin = 75,
                width = 1100 - margin,
                height = 600 - margin;

            debugger;

            var svg = dimple.newSvg("#number-of-loans")
                        .attr("width", width + margin)
                        .attr("height", height + margin)
                        .append('g')
                        .attr('class','chart');


            var myChart = new dimple.chart(svg, data);
            var x = myChart.addCategoryAxis("x", "YearlyIncomeRounded");
            var y = myChart.addMeasureAxis("y", "number_of_loans");

            x.addOrderRule("YearlyIncomeRounded", false);
            x.tickFormat = '$,';
            x.title = "Yearly Income Rounded to Lowest $10,000";

            y.tickFormat = ',.f';
            y.title = 'Number of Loans Granted';

            x.fontSize = 12;
            y.fontSize = 12;

            var s2 = myChart.addSeries(null, dimple.plot.bar);

            myChart.draw();
            x.categoryFields = ['Yearly Income Bracket'];
            //y.categoryFields = ['Number of Loans'];

            svg.select("g.dimple-axis").selectAll("g.tick")[0][16].remove()
            svg.append("text")
                .attr("x", myChart._xPixels() + myChart._widthPixels() / 2)
                .attr("y", myChart._yPixels() - 25)
                .style("text-anchor", "middle")
                .style("font-family", "sans-serif")
                .style("font-weight", "bold")
                .text("Number of Loans by Income Bracket")

        }
        function draw_third(data){
            //graph for loan as percentage of income

            var margin = 75,
                width = 1100 - margin,
                height = 600 - margin;

            debugger;

            var svg = dimple.newSvg("#percentage")
                        .attr("width", width + margin)
                        .attr("height", height + margin)
                        .append('g')
                        .attr('class','chart');

            //To exclude the "$0" row
            var data_new = data.slice(1,16);

            var myChart = new dimple.chart(svg, data_new);
            var x = myChart.addCategoryAxis("x", "YearlyIncomeRounded");
            var y = myChart.addMeasureAxis("y", "mean_percentage_of_income");

            x.addOrderRule("YearlyIncomeRounded", false);
            x.tickFormat = '$,';
            x.title = "Yearly Income Rounded to Lowest $10,000";

            y.tickFormat = ',.2f';
            y.title = 'Percentage of Income';

            x.fontSize = 12;
            y.fontSize = 12;

            var s3 = myChart.addSeries(null, dimple.plot.bar);

            myChart.draw();
            x.categoryFields = ['Yearly Income Bracket'];
            //y.categoryFields = ['Number of Loans'];

            svg.select("g.dimple-axis").selectAll("g.tick")[0][15].remove()
            svg.append("text")
                .attr("x", myChart._xPixels() + myChart._widthPixels() / 2)
                .attr("y", myChart._yPixels() - 25)
                .style("text-anchor", "middle")
                .style("font-family", "sans-serif")
                .style("font-weight", "bold")
                .text("Average Percentage of Income for Loan by Income Bracket")
        }
        d3.csv("MeanLoanAmountProsperLoanData.csv", draw_first);
        d3.csv("MeanLoanAmountProsperLoanData.csv", draw_second);
        d3.csv("MeanLoanAmountProsperLoanData.csv", draw_third);

    </script>
    <h1>
        Debt Consolidation Loans Granted by Prosper Loans
    </h1>
    <p>
        Prosper Loans is a peer-to-peer lending company that grants loans to people looking to avoid banks as the source of their loan. Though loans may be requested for various reasons, the most commonly cited reason for loans granted by Prosper has been debt consolidation. I wanted to investigate the demographics of those seeking prosper loans for debt consolidation. In particular I was interested in variation by income and I wanted to answer the following: how much money do people using prosper loans request based relative to their income income, and how many people are utilizing prosper loans at various income levels?
    </p>
    <h3>
        Average Loan Amount by Income
    </h3>
    <p>
        First I looked at the mean loan amounts by income brackets. The motivation was to see the average amount requested for debt consolidation as income increases. I felt that grouping income by $10,000's would allow us to avoid unhelpful variance without losing too much information by using larger bins.
        As we expect, with the exception of a slightly higher mean amount for people with less than $10,000 of income, people with higher incomes borrow more money for debt consolidation on average than those with lower income.
    </p>

    <div id="income-by-bracket"></div>
    <h3>
        Average Percentage of Income
    </h3>
    <p>
        It seems that people with higher incomes need higher amounts for debt consolidation. However, on average the actual percentage of income taken out for a loan decreases as income increases. Notice, too, that those in the $10,000 bracket are borrowing almost 30% of their income on average.
    </p>
    <div id="percentage"></div>
    <h3>
        Number of Borrowers by Income
    </h3>
    <p>
        We also want to know how many people fit into each bracket to know the demographic of users. We see below that most people seeking prosper loans make $30,000-$70,000 per year. There's also a huge drop off in number of loans granted per income bracket after $100,000.
    </p>
    <div id="number-of-loans"></div>
    <h3>
        Conclusion
    </h3>
    <p>
        People who take loans from Prosper Loans borrow higher amounts the higher their income is. However, as a total percentage of income, the loan as a portion of income decreases as income increases. People also seem to borrow in greater quantities in the income levels from $30,000-$70,000.
    </p>
</body>
</html>
